{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://shopq.dev/schemas/email_classification_mvp.v1.json",
  "title": "ShopQ Email Classification (MVP v1)",
  "description": "Schema for 4-label classification system. Note: domains/domain_conf removed.",
  "type": "object",
  "required": [
    "type", "type_conf",
    "attention", "attention_conf",
    "relationship", "relationship_conf",
    "decider", "reason",
    "propose_rule"
  ],
  "additionalProperties": true,
  "properties": {
    "type": {
      "type": "string",
      "enum": ["otp", "newsletter", "notification", "receipt", "event", "promotion", "message", "uncategorized"]
    },
    "type_conf": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "time_sensitive", "routine"]
    },
    "importance_conf": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "attention": {
      "type": "string",
      "enum": ["action_required", "none"]
    },
    "attention_conf": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "client_label": {
      "type": "string",
      "enum": ["receipts", "action-required", "messages", "everything-else"]
    },
    "relationship": {
      "type": "string",
      "enum": ["from_contact", "from_unknown"]
    },
    "relationship_conf": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "decider": {
      "type": "string",
      "enum": ["rule", "gemini", "fallback", "type_mapper"],
      "description": "Which system made the classification decision"
    },
    "reason": {
      "type": "string",
      "maxLength": 240
    },
    "propose_rule": {
      "type": "object",
      "required": ["should_propose", "pattern", "kind", "support_count"],
      "additionalProperties": false,
      "properties": {
        "should_propose": {"type": "boolean"},
        "pattern": {"type": "string"},
        "kind": {"type": "string", "enum": ["exact", "wildcard"]},
        "support_count": {"type": "integer", "minimum": 0}
      }
    }
  }
}
