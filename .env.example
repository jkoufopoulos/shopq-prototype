# Reclaim Environment Variables Template
# Copy this file to .env and fill in your actual values

# ===========================================
# LLM API Keys
# ===========================================

# Google Cloud / Gemini API Key (Required for email classification)
# Get from: https://makersuite.google.com/app/apikey
GOOGLE_API_KEY=your-google-api-key-here

# Anthropic API Key (Optional - for Claude-based quality analysis)
# Get from: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=your-anthropic-api-key-here

# OpenAI API Key (Optional - for GPT-based features if enabled)
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here

# ===========================================
# GitHub Integration (Optional - for quality monitoring)
# ===========================================

# GitHub Personal Access Token (for creating quality issues)
# Get from: https://github.com/settings/tokens
# Required scopes: repo, issues
GITHUB_TOKEN=your-github-token-here

# ===========================================
# Reclaim Configuration
# ===========================================

# Google Cloud Project ID
GOOGLE_CLOUD_PROJECT=shopq-467118

# Admin API Key (REQUIRED for production)
# Protects admin endpoints: POST/PUT/DELETE /api/categories, /api/rules
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# WARNING: Production deployment will FAIL if this is not set (security requirement)
SHOPQ_ADMIN_API_KEY=your-secure-api-key-here

# Chrome Extension ID (Required for production CORS)
# Get this after publishing to Chrome Web Store
# Development mode allows all extension IDs for testing unpacked extensions
SHOPQ_EXTENSION_ID=

# Vertex AI Configuration (for Gemini classifier)
# Project ID for Vertex AI API calls
VERTEX_AI_PROJECT_ID=shopq-467118
# Region for Vertex AI API calls
VERTEX_AI_LOCATION=us-central1

# Gemini Model Configuration
GEMINI_MODEL=gemini-2.0-flash-001
GEMINI_LOCATION=us-central1
GEMINI_MAX_TOKENS=1024
GEMINI_TEMPERATURE=0.1

# Reclaim API URL (used by quality monitor and tests)
SHOPQ_API_URL=https://shopq-api-488078904670.us-central1.run.app

# ===========================================
# Quality Monitor Settings (Optional)
# ===========================================

# How often to check for new sessions (minutes)
CHECK_INTERVAL_MINUTES=30

# Minimum emails required before triggering analysis
MIN_EMAILS_FOR_ANALYSIS=25

# Webhook server port for quality monitoring
QUALITY_WEBHOOK_PORT=9000

# ===========================================
# Gmail OAuth (REQUIRED for Gmail API integration)
# ===========================================

# OAuth Credential Encryption Key (REQUIRED)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# SECURITY: Keep this secret! Rotating it will invalidate all stored OAuth credentials.
# Store in secure secret manager for production (e.g., Google Secret Manager, AWS Secrets Manager)
SHOPQ_ENCRYPTION_KEY=your-fernet-encryption-key-here

# Gmail OAuth Client Secrets File Path (REQUIRED for OAuth flow)
# Download OAuth 2.0 Client ID (Desktop app type) from:
# https://console.cloud.google.com/apis/credentials
# Place the downloaded JSON file at this path
# Default: credentials/credentials.json
GMAIL_OAUTH_CLIENT_SECRETS=credentials/credentials.json

# Token Refresh Buffer (Optional - defaults to 300 seconds / 5 minutes)
# How many seconds before expiry to proactively refresh access tokens
# Increase for networks with high latency, decrease for lower API load
# SHOPQ_TOKEN_REFRESH_BUFFER_SEC=300

# ===========================================
# Email Delivery (Optional - for digest delivery)
# ===========================================

# SMTP Configuration (if using email delivery)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM_EMAIL=your-email@gmail.com
SMTP_FROM_NAME=Reclaim

# ===========================================
# Feature Flags & Debug
# ===========================================

# Enable debug logging
DEBUG=false

# Authentication required for API endpoints
AUTH_REQUIRED=false

# Enable LLM-based classification
USE_AI_CLASSIFIER=true

# Enable rules engine
USE_RULES_ENGINE=true

# Auto-apply Gmail labels
AUTO_LABEL=false

# Environment (development/production)
SHOPQ_ENV=development

# ===========================================
# V2 Digest Pipeline Feature Flags
# ===========================================

# Force enable/disable V2 digest pipeline (overrides percentage rollout)
# Set to "true" to force V2 for all requests
# Set to "false" to force V1 for all requests
# Leave unset to use percentage-based rollout
# FORCE_DIGEST_V2=false

# Percentage-based rollout for V2 digest pipeline (0-100)
# 0 = disabled for all users
# 100 = enabled for all users
# 1-99 = gradual rollout using consistent hashing on user_id
# Default: 100 (V2 enabled - V1 will be archived after validation)
DIGEST_V2_ROLLOUT_PERCENTAGE=100

# Enable LLM fallback for digest section assignment
# When enabled, uses Gemini to classify ambiguous emails when rules don't match
# This follows the same hybrid pattern as GDS classification (rules â†’ LLM)
# Set to "true" to enable LLM fallback (adds ~$0.0001 per ambiguous email)
# Set to "false" to use rules-only classification (default)
# Default: false
SHOPQ_LLM_SECTION_FALLBACK=false

# Enable LLM-generated digest synthesis
# When enabled, Gemini generates the entire digest HTML (greeting, sections, summary)
# using the digest_synthesis_prompt_v2.txt prompt template.
# Set to "false" to use deterministic template-based rendering instead.
# Default: true (LLM synthesis is the default rendering mode)
SHOPQ_LLM_SYNTHESIS=true

# ===========================================
# A/B Testing
# ===========================================

# Enable A/B testing mode (run both V1 and V2 pipelines and compare)
# When enabled, both pipelines run on every request and metrics are stored
# WARNING: This DOUBLES latency and LLM costs. Use only for testing/validation.
# Set to "true" to enable A/B testing
# Set to "false" to use feature flag-based routing (default)
# Default: false
AB_TEST_ENABLED=false

# ===========================================
# Uber Direct API (Return Pickup Feature)
# ===========================================

# Use mock Uber API responses (for development/testing)
# Set to "false" to use real Uber Direct API (requires credentials below)
# Default: true
UBER_DIRECT_MOCK=true

# Uber Direct OAuth Credentials (Required for production)
# Get from: https://developer.uber.com/docs/direct/getting-started
# UBER_DIRECT_CLIENT_ID=your-client-id-here
# UBER_DIRECT_CLIENT_SECRET=your-client-secret-here
# UBER_DIRECT_CUSTOMER_ID=your-customer-id-here

# Uber Webhook Secret (for delivery status updates)
# Used to validate webhook signatures from Uber
# UBER_DIRECT_WEBHOOK_SECRET=your-webhook-secret-here

# ===========================================
# Advanced Settings
# ===========================================

# API Server Configuration
API_HOST=0.0.0.0
API_PORT=8000
LOG_LEVEL=INFO

# Database path override (optional)
# SHOPQ_DB_PATH=/custom/path/to/shopq.db

# Storage bucket for tracking data
SHOPQ_TRACKING_BUCKET=shopq-tracking
GCP_PROJECT=shopq-467118

# Weather API (optional - for context enrichment)
# OPENWEATHER_API_KEY=your-openweather-api-key
