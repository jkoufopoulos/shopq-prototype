<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MailQ Test Bookmarklet</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .bookmarklet {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 18px;
            margin: 20px 0;
            cursor: move;
        }
        .bookmarklet:hover {
            background: #45a049;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
        h1 { color: #333; }
        h2 { color: #555; margin-top: 30px; }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            border-left-color: #28a745;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>MailQ Label Verification Bookmarklet</h1>

    <div class="section">
        <h2>Quick Setup (Drag this to your bookmarks bar):</h2>
        <a href="javascript:(function()%7B(async%20function()%7Bconsole.clear()%3Bconsole.log('%F0%9F%A7%AA%20MailQ%20Label%20Verification%20Test%5Cn'%2B'%3D'.repeat(50))%3Bconst%20rows%3Ddocument.querySelectorAll('tr%5Brole%3D%22row%22%5D')%7C%7Cdocument.querySelectorAll('.zA')%7C%7Cdocument.querySelectorAll('%5Bdata-thread-id%5D')%3Bif(rows.length%3D%3D%3D0)%7Bconsole.error('%E2%9D%8C%20No%20emails%20found%20(Issue%20%236%3A%20DOM%20selectors%20broken)')%3Breturn%7Dconsole.log(%60%F0%9F%93%A7%20Found%20%24%7Brows.length%7D%20emails%5Cn%60)%3Blet%20withLabels%3D0%3Blet%20withoutLabels%3D0%3BArray.from(rows).slice(0%2C20).forEach((row%2Ci)%3D%3E%7Bconst%20text%3Drow.textContent%3Bconst%20subject%3Dtext.split('%5Cn').find(l%3D%3El.trim().length%3E10)%7C%7C'Unknown'%3Bconst%20hasMailQ%3Dtext.includes('MailQ')%3Bif(hasMailQ)%7BwithLabels%2B%2B%3Bconsole.log(%60%E2%9C%85%20%5B%24%7Bi%2B1%7D%5D%20HAS%20MailQ%3A%20%24%7Bsubject.substring(0%2C50)%7D...%60)%7Delse%7BwithoutLabels%2B%2B%3Bconsole.log(%60%E2%9D%8C%20%5B%24%7Bi%2B1%7D%5D%20NO%20MailQ%3A%20%24%7Bsubject.substring(0%2C50)%7D...%60)%7D%7D)%3Bconsole.log('%5Cn'%2B'%3D'.repeat(50))%3Bconsole.log(%60%F0%9F%93%8A%20RESULTS%3A%60)%3Bconsole.log(%60%20%20%20With%20MailQ%20labels%3A%20%24%7BwithLabels%7D%60)%3Bconsole.log(%60%20%20%20Without%20MailQ%20labels%3A%20%24%7BwithoutLabels%7D%60)%3Bconsole.log(%60%20%20%20Labeling%20rate%3A%20%24%7B(withLabels%2F(withLabels%2BwithoutLabels)*100).toFixed(1)%7D%25%60)%3Bif(withoutLabels%3E0)%7Bconsole.log('%5Cn%E2%9A%A0%EF%B8%8F%20%20ISSUE%20%237%20DETECTED%3A')%3Bconsole.log(%60%20%20%20%24%7BwithoutLabels%7D%20emails%20have%20NO%20labels%60)%3Bconsole.log('%5Cn%F0%9F%93%8B%20Action%3A%20Check%20if%20console%20shows%20%22labeled%20successfully%22%20for%20these')%3Bconsole.log('%20%20%20If%20YES%20%E2%86%92%20Issue%20%237%20confirmed%20(logs%20lie)')%3Bconsole.log('%20%20%20If%20NO%20%E2%86%92%20Extension%20hasn%5C't%20processed%20these%20yet')%7Delse%7Bconsole.log('%5Cn%E2%9C%85%20All%20emails%20have%20MailQ%20labels!')%7D%7D)()%7D)()" class="bookmarklet">
            üß™ Test MailQ Labels
        </a>
        <p><strong>Drag the green button above to your bookmarks bar</strong></p>
    </div>

    <div class="section">
        <h2>How to Use:</h2>
        <ol>
            <li>Drag the green "Test MailQ Labels" button to your bookmarks bar</li>
            <li>Go to Gmail in Chrome (with MailQ extension loaded)</li>
            <li>Click the bookmark</li>
            <li>Open DevTools Console (F12) to see results</li>
        </ol>
    </div>

    <div class="warning">
        <h2>‚ö†Ô∏è Alternative: Manual Console Method</h2>
        <p>If bookmarklet doesn't work, open Gmail, press F12, and paste this:</p>
        <pre><code id="manual-code">(async function() {
  console.clear();
  console.log('üß™ MailQ Label Verification Test\n' + '='.repeat(50));

  const rows = document.querySelectorAll('tr[role="row"]') ||
               document.querySelectorAll('.zA') ||
               document.querySelectorAll('[data-thread-id]');

  if (rows.length === 0) {
    console.error('‚ùå No emails found (Issue #6: DOM selectors broken)');
    return;
  }

  console.log(`üìß Found ${rows.length} emails\n`);

  let withLabels = 0;
  let withoutLabels = 0;

  Array.from(rows).slice(0, 20).forEach((row, i) => {
    const text = row.textContent;
    const subject = text.split('\n').find(l => l.trim().length > 10) || 'Unknown';
    const hasMailQ = text.includes('MailQ');

    if (hasMailQ) {
      withLabels++;
      console.log(`‚úÖ [${i+1}] HAS MailQ: ${subject.substring(0, 50)}...`);
    } else {
      withoutLabels++;
      console.log(`‚ùå [${i+1}] NO MailQ: ${subject.substring(0, 50)}...`);
    }
  });

  console.log('\n' + '='.repeat(50));
  console.log(`üìä RESULTS:`);
  console.log(`   With MailQ labels: ${withLabels}`);
  console.log(`   Without MailQ labels: ${withoutLabels}`);
  console.log(`   Labeling rate: ${(withLabels/(withLabels+withoutLabels)*100).toFixed(1)}%`);

  if (withoutLabels > 0) {
    console.log('\n‚ö†Ô∏è  ISSUE #7 DETECTED:');
    console.log(`   ${withoutLabels} emails have NO labels`);
    console.log('\nüìã Action: Check if console shows "labeled successfully" for these');
    console.log('   If YES ‚Üí Issue #7 confirmed (logs lie)');
    console.log('   If NO ‚Üí Extension hasn\'t processed these yet');
  } else {
    console.log('\n‚úÖ All emails have MailQ labels!');
  }
})();</code></pre>
        <button onclick="copyCode()" style="padding: 10px 20px; margin-top: 10px; cursor: pointer;">
            üìã Copy to Clipboard
        </button>
    </div>

    <div class="section">
        <h2>üìä Interpreting Results</h2>

        <h3>‚úÖ Good Result (Issue #7 Fixed):</h3>
        <div class="success">
            <pre>üìä RESULTS:
   With MailQ labels: 20
   Without MailQ labels: 0
   Labeling rate: 100.0%

‚úÖ All emails have MailQ labels!</pre>
            <p><strong>Meaning:</strong> Labels are actually being applied. Safe to deploy!</p>
        </div>

        <h3>‚ùå Bad Result (Issue #7 Confirmed):</h3>
        <div class="warning">
            <pre>üìä RESULTS:
   With MailQ labels: 2
   Without MailQ labels: 18
   Labeling rate: 10.0%

‚ö†Ô∏è  ISSUE #7 DETECTED:
   18 emails have NO labels</pre>
            <p><strong>Meaning:</strong> If console shows "42/42 labeled successfully" but only 2 have labels, Issue #7 is confirmed. Don't deploy yet.</p>
        </div>
    </div>

    <div class="section">
        <h2>üîÑ Best Practice: Before & After Test</h2>
        <ol>
            <li><strong>Before:</strong> Run test ‚Üí Note how many unlabeled emails</li>
            <li><strong>Action:</strong> Click MailQ button in Gmail</li>
            <li><strong>After:</strong> Run test again ‚Üí Compare results</li>
            <li><strong>Verify:</strong> Did unlabeled count decrease? By how much?</li>
        </ol>
        <p><strong>Example:</strong></p>
        <ul>
            <li>Before: 20 unlabeled</li>
            <li>Extension logs: "20/20 labeled successfully"</li>
            <li>After: 18 unlabeled (only 2 actually labeled)</li>
            <li><strong>Accuracy: 10%</strong> ‚Üí Issue #7 confirmed</li>
        </ul>
    </div>

    <div class="section">
        <h2>üêõ Troubleshooting</h2>
        <ul>
            <li><strong>"No emails found":</strong> Issue #6 (DOM selectors broken). Gmail may have changed.</li>
            <li><strong>"Labeling rate: 0%":</strong> Extension may not have run yet. Click MailQ button first.</li>
            <li><strong>Bookmarklet doesn't work:</strong> Use manual console method instead.</li>
        </ul>
    </div>

    <script>
        function copyCode() {
            const code = document.getElementById('manual-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ Code copied! Now:\n1. Go to Gmail\n2. Press F12\n3. Paste in Console\n4. Press Enter');
            });
        }
    </script>
</body>
</html>
