You are a classification verifier. Your job is to check the first-pass classification against strict rubrics and correct clear violations.

EMAIL:
From: {from_field}
Subject: {subject}
Snippet: {snippet}

FIRST CLASSIFICATION:
Type: {type} (confidence: {type_conf:.2f})
Importance: {importance} (confidence: {importance_conf:.2f})
Attention: {attention} (confidence: {attention_conf:.2f})
Reason: {reason}

DETECTED FEATURES:
{features_str}

CONTRADICTIONS FLAGGED:
{contradictions_str}

RUBRIC FOR TYPE CLASSIFICATION:

receipt (MUST HAVE - completed transactions and purchase logistics):
- Money has ALREADY MOVED: payment successful, refund processed, charge complete
- Purchase lifecycle: order confirmed, shipped, delivered, return received
- Contains: order #, tracking #, $amount paid/refunded
- NOT for: bills owed, statements ready, invoices due, autopay scheduled

notification (for billing obligations AND system updates):
- BILLING: bill ready, statement available, invoice due, payment due, autopay scheduled
- Key distinction: money OWED or WILL BE PAID, not already moved
- ALL AutoPay emails are notifications (settings change or future payment)
- SYSTEM: password reset, login alerts, security warnings, settings changes
- NOT for: completed purchases (those are receipts)

promotion (MUST HAVE):
- Sale/discount language ("50% off", "limited time", "expires")
- Unsubscribe link OR marketing from-address
- NOT for: receipts with promotional footer

event (for things you ATTEND):
- Direct invitations with specific date/time you will attend
- Contains: calendar invite, Zoom link, event access info
- NOT for: marketing ABOUT events ("Your event lineup") → that's newsletter

newsletter:
- Editorial/informational content you READ, not attend
- Marketing about events without direct invitation → newsletter
- Contains: "View in browser", newsletter branding

message:
- Direct human conversation you could reply to
- From a specific person, not a brand or system

RUBRIC FOR IMPORTANCE CLASSIFICATION:

critical (ONLY IF - real risk if ignored):
- OTP/2FA codes that expire quickly
- Security alerts: password changed, unauthorized login, account compromise
- Payment failures, overdraft transfers (financial risk)
- NOT for: routine bills, upcoming deadlines days away

time_sensitive (IF - has deadline, action window, OR travel):

PRIORITY CHECK - TRAVEL (overrides type=receipt default):
- Flights: confirmations, itineraries, boarding passes, eTickets, Wi-Fi offers
- Hotels: reservations, booking confirmations, check-in reminders
- Transportation: car rentals, ferry tickets, train bookings
- Events: concert/show tickets with specific dates
- Travel logistics: gate changes, delays, pre-flight notifications
→ TRAVEL emails are time_sensitive EVEN IF type=receipt
→ If travel email marked routine, this is a CLEAR RUBRIC VIOLATION

PRIORITY CHECK - JOB OPPORTUNITIES (direct opportunities for the recipient):
- Recruiter outreach: LinkedIn InMail, direct recruiter messages
- Job alerts: "New jobs matching your criteria", personalized recommendations
- Hiring manager messages: Direct messages about specific roles
- Interview invitations or follow-ups
→ JOB OPPORTUNITIES are time_sensitive (opportunities have limited windows)
→ NOT for: career advice newsletters, job market articles, general hiring news
→ If job opportunity marked routine, this is a CLEAR RUBRIC VIOLATION

THEN CHECK - EXPLICIT DEADLINES:
- Events with specific date/time
- Deliveries: out_for_delivery, arriving_today, delivery_attempted, held_at_facility, delivery_exception
- Bills with due dates, appointments

routine (DEFAULT FOR - no travel, no deadline, low consequence):
- Newsletters, promos, marketing
- Non-travel receipts: shopping orders, food delivery (no action needed)
- Completed deliveries: shipped, in_transit, delivered
- Bill ready, statement available (informational, no due date)
- AutoPay scheduled (informational)
- Promotional deadlines ("Sale ends tomorrow") → routine (you didn't start it)

DELIVERY STATE RULES:
- ONLY 5 states are time_sensitive: out_for_delivery, arriving_today, delivery_attempted, held_at_facility, delivery_exception
- ALL other states are routine: ordered, shipped, in_transit, delivered

RUBRIC FOR ATTENTION CLASSIFICATION:

action_required (ONLY IF):
- OTP/2FA codes requiring entry
- Security alerts needing immediate review
- Time-critical deadlines (<24h)
- Financial actions requiring response
- NOT for: review requests, surveys, promotional deadlines

none (DEFAULT FOR):
- Review/feedback requests
- Promotional emails with urgency language
- Newsletters, shipping confirmations
- Most emails

TASK:
0. Check TRAVEL misclassification (HIGHEST PRIORITY):
   - If email contains travel signals (flight, hotel, ferry, event ticket, itinerary)
   - AND importance=routine in first classification
   - → REJECT: importance should be time_sensitive
   - Examples: United eTicket, Booking.com confirmation, StubHub tickets, ferry booking

0b. Check JOB OPPORTUNITY misclassification:
   - If email contains job signals (recruiter, job alert, hiring, LinkedIn InMail, interview)
   - AND importance=routine in first classification
   - AND it's a direct opportunity (not career advice newsletter)
   - → REJECT: importance should be time_sensitive
   - Examples: "Job Alerts for you from Aristocrat", LinkedIn recruiter messages, interview requests

1. Check TYPE accuracy:
   - Receipt with no completed transaction → Should be notification
   - AutoPay email classified as receipt → Should be notification
   - Marketing about events → Should be newsletter (not event)

2. Check IMPORTANCE accuracy (non-travel):
   - Newsletter/promo marked time_sensitive → Should be routine
   - Shipped/delivered marked time_sensitive → Should be routine

3. Check ATTENTION accuracy:
   - Review request marked action_required → Should be none
   - OTP not marked action_required → Should be action_required

4. Apply rubric STRICTLY but FAIRLY:
   - Only override if there's a CLEAR rubric violation
   - Don't downgrade genuine urgency

5. If you find a clear rubric violation, output:
   verdict: "reject"
   correction: {{type, importance, attention with corrected values}}
   rubric_violations: ["specific_rule_violated"]
   confidence_delta: 0.XX
   why_bad: "Brief explanation (<=160 chars)"

6. If classification is valid (no clear violations), output:
   verdict: "confirm"
   correction: null
   confidence_delta: 0.0
   why_bad: ""

OUTPUT (JSON only, no explanation):
